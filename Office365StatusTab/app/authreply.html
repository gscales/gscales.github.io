<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
</head>
<body>
    <script src="https://secure.aadcdn.microsoftonline-p.com/lib/1.0.13/js/adal.min.js"></script>
    <script src="https://statics.teams.microsoft.com/sdk/v0.2/js/MicrosoftTeams.min.js"></script>
    <script type="text/javascript">
        
        // Initialize microsoft teams tab library
        microsoftTeams.initialize();
        
        let hashParams = getHashParameters();
        if (hashParams["error"]) {
            // Authentication/authorization failed
            microsoftTeams.authentication.notifyFailure(hashParams["error"]);
        } else if (hashParams["access_token"]) {
            // Get the stored state parameter and compare with incoming state
            // This validates that the data is coming from Azure AD
            let expectedState = localStorage.getItem("simple.state");
            if (expectedState !== hashParams["state"]) {
                // State does not match, report error
                microsoftTeams.authentication.notifyFailure("StateDoesNotMatch");
            } else {
                // Success: return token information to the tab
                microsoftTeams.authentication.notifySuccess({
                    idToken: hashParams["id_token"],
                    accessToken: hashParams["access_token"],
                    tokenType: hashParams["token_type"],
                    expiresIn: hashParams["expires_in"]
                })
            }
        } else {
            // Unexpected condition: hash does not contain error or access_token parameter
            microsoftTeams.authentication.notifyFailure("UnexpectedFailure");
        }
    </script>
</body>
</html>